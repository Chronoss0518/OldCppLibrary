#include"../../BaseIncluder/ChBase.h"
#include"ChHitTestObject.h"
#include"ChHitTestRay.h"
#include"ChHitTestPanel.h"
#include"ChHitTestBox.h"
#include"ChHitTestSphere.h"
#include"ChHitTestMesh.h"

using namespace ChCpp;

const std::map<HitTestRayDirctionAxis, std::function<ChVec3()>>HitTestRay::GetRayAxis
{
	{HitTestRayDirctionAxis::Top,[]()->ChVec3 {return ChVec3(0.0f,1.0f,0.0f); }},
	{HitTestRayDirctionAxis::Down,[]()->ChVec3 {return ChVec3(0.0f,-1.0f,0.0f); }},
	{HitTestRayDirctionAxis::Front,[]()->ChVec3 {return ChVec3(0.0f,0.0f,1.0f); }},
	{HitTestRayDirctionAxis::Back,[]()->ChVec3 {return ChVec3(0.0f,0.0f,-1.0f); }},
	{HitTestRayDirctionAxis::Right,[]()->ChVec3 {return ChVec3(1.0f,0.0f,0.0f); }},
	{HitTestRayDirctionAxis::Left,[]()->ChVec3 {return ChVec3(-1.0f,0.0f,0.0f); }}
};

///////////////////////////////////////////////////////////////////////////////////////
//HitTestRay Method//
///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestRay::IsHitPanel(
	const HitTestPanel* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestRay::IsHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestRay::IsHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestRay::IsHitMesh(
	const HitTestMesh* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestRay::IsInnerHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestRay::IsInnerHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////
//HitTestPanel Method//
///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestPanel::IsHitPanel(
	const HitTestPanel* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestPanel::IsHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestPanel::IsHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestPanel::IsHitMesh(
	const HitTestMesh* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestPanel::IsInnerHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestPanel::IsInnerHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////
//HitTestBox Method//
///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestBox::IsHitPanel(
	const HitTestPanel* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestBox::IsHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestBox::IsHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestBox::IsHitMesh(
	const HitTestMesh* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestBox::IsInnerHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestBox::IsInnerHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////
//HitTestSphere Method//
///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestSphere::IsHitPanel(
	const HitTestPanel* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestSphere::IsHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestSphere::IsHitSphere(
	const HitTestSphere* _Target)
{
	ChLMatrix TmpMat = GetLMat();

	TmpMat.Inverse();

	//Ž©g‚ÌÀ•WŒn‚©‚çŒ©‚½Target‚ÌÀ•WŒn//
	TmpMat = TmpMat * _Target->GetLMat();

	ChVec3 BSize = GetLen();

	ChVec3 TSize = _Target->GetLen();
	TSize = TSize * TmpMat.GetScalling();


	ChVec3 TmpDir = TmpMat.GetPosition();
	
	float Length = TmpDir.Len();

	TmpDir.Normalize();

	TSize *= TmpDir;

	TSize.Abs();

	BSize *= TmpDir;

	BSize.Abs();

	float TmpSize = (TSize.Len() + BSize.Len());

	ChStd::Bool HitFlg = Length <= TmpSize;
	
	if (HitFlg)
	{
		SetHitVector((TmpDir * (TmpSize - Length)));
	}

	return HitFlg;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestSphere::IsHitMesh(
	const HitTestMesh* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestSphere::IsInnerHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestSphere::IsInnerHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////
//HitTestMesh Method//
///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestMesh::IsHitPanel(
	const HitTestPanel* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool HitTestMesh::IsHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestMesh::IsHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestMesh::IsHitMesh(
	const HitTestMesh* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestMesh::IsInnerHitBox(
	const HitTestBox* _Target)
{
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////

ChStd::Bool  HitTestMesh::IsInnerHitSphere(
	const HitTestSphere* _Target)
{
	return false;
}
