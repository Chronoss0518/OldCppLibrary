#include"../../BaseIncluder/ChBase.h"
#include"ChNetWork.h"
#include"ChSockBase.h"
#include"ChInternetProtocol.h"

namespace ChCpp
{
	///////////////////////////////////////////////////////////////////////////////
	//Serverメソッド//
	///////////////////////////////////////////////////////////////////////////////

	void Server::Init(const unsigned short _Port_No)
	{

		//アドレスファミリの指定
		Addr.sin_family = AF_INET;

		//サーバのIPアドレス
		//htonl:ネットワークバイトオーダーからホストバイトオーダーへ変換する//
		Addr.sin_addr.s_addr = htonl(INADDR_ANY);

		//サーバのポート番号//
		//htons:ホストバイトオーダーからネットワークバイトオーダーへ変換する//
		Addr.sin_port = htons(_Port_No);
	}

	void Server::Release()
	{

	}

	///////////////////////////////////////////////////////////////////////////////

	void Server::SetLinkSocket(const std::vector<SOCKET>& _LinksSock)
	{
		if (_LinksSock.empty())return;

		if (!LinkSock.empty())
		{
			LinkSock.clear();
		}

		LinkSock = _LinksSock;

	}

	///////////////////////////////////////////////////////////////////////////////

	void Server::Update()
	{

	}

	///////////////////////////////////////////////////////////////////////////////

	void Server::Link()
	{

	}


	///////////////////////////////////////////////////////////////////////////////
	//Clientメソッド//
	///////////////////////////////////////////////////////////////////////////////

	void Client::Release()
	{

	}

	///////////////////////////////////////////////////////////////////////////////

	void Client::Link()
	{

	}

	///////////////////////////////////////////////////////////////////////////////
	//IP_TCPメソッド//
	///////////////////////////////////////////////////////////////////////////////

	ChStd::Bool IP_TCP::Init(NetWorkBase::SockBase* _Base)
	{

		InternetProtocol::Init(_Base);

		SOCKET Test;

		Test = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);

		if (Test == SOCKET_ERROR)
		{
			ChFIO::OutToErrorText(
				"NetWorkProgrammError"
				, "ソケットの生成(socket())に失敗しました。"
				, ChFIO::OTEAddType::AfterFirst);

			return false;
		}

		InsSocket(*_Base);


		Test = bind(InsSocket(
			*_Base)
			, InsSockAddr(*_Base)
			, sizeof(InsSockAddr_In(*_Base)));


		if (Test == SOCKET_ERROR)
		{
			ChFIO::OutToErrorText(
				"NetWorkProgrammError"
				, "紐づけ(bind())に失敗しました。"
				, ChFIO::OTEAddType::AfterFirst);

			return false;
		}


		return true;
	}

	///////////////////////////////////////////////////////////////////////////////

	ChStd::Bool IP_TCP::Send(
		const std::string& _Str)
	{
		return true;
	}

	///////////////////////////////////////////////////////////////////////////////

	ChStd::Bool IP_TCP::Receve()
	{

		return true;
	}

	///////////////////////////////////////////////////////////////////////////////

	std::string IP_TCP::TargetSend(
		const SOCKET& _TargetSocket
		, const std::string& _Str)
	{

		return "";
	}

	///////////////////////////////////////////////////////////////////////////////

	std::string IP_TCP::TargetReceve(
		const SOCKET& _TargetSocket)
	{

		return "";
	}

	///////////////////////////////////////////////////////////////////////////////
	//IP_UDPメソッド//
	///////////////////////////////////////////////////////////////////////////////


	ChStd::Bool IP_UDP::Init(NetWorkBase::SockBase* _Base)
	{

		InternetProtocol::Init(_Base);



		SetInitFlg(true);
		return true;
	}

	///////////////////////////////////////////////////////////////////////////////

	ChStd::Bool IP_UDP::Send(const std::string& _Str)
	{

		return true;
	}

	///////////////////////////////////////////////////////////////////////////////

	ChStd::Bool IP_UDP::Receve()
	{

		return true;
	}

}